<div class="modal" tabindex="-1" [ngStyle]="{ display: displayStyle }" role="dialog">
  <div class="modal-dialog modal-centered modal-xl">
    <div class="modal-content">
      <ng-container *ngIf="step === 1 && mode !== 'delete'">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center">{{ mode | titlecase }} Unit Schedule</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
            (click)="onCancel()"
          ></button>
        </div>

        <div class="modal-body">
          <nav
            style="
              --bs-breadcrumb-divider: url(
                &#34;data:image/svg + xml,
                %3Csvgxmlns='http://www.w3.org/2000/svg'width='8'height='8'%3E%3Cpathd='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z'fill='currentColor'/%3E%3C/svg%3E&#34;
              );
            "
            aria-label="breadcrumb"
          >
            <ol class="breadcrumb justify-content-center">
              <li class="breadcrumb-item d-flex align-items-center">
                <span
                  class="px-2 d-flex align-items-center justify-content-center"
                  appDot
                  [status]="unitsStatus"
                ></span>
                <span class="px-2" [ngClass]="{ 'text-active': step === 1 }">Units</span>
              </li>
              <img src="{{ chevronRight }}" alt="" />
              <li class="breadcrumb-item d-flex align-items-center">
                <ng-container *ngIf="assetClass.investmentStrategy === 'buildToSell'">
                  <span
                    class="px-2 d-flex align-items-center justify-content-center"
                    appDot
                    [status]="salesStatus"
                  ></span>
                  <span class="px-2">Sales</span>
                </ng-container>

                <ng-container *ngIf="assetClass.investmentStrategy === 'buildToRent'">
                  <span
                    class="px-2 d-flex align-items-center justify-content-center"
                    appDot
                    [status]="lettingsStatus"
                  ></span>
                  <span class="px-2">Lettings</span>
                </ng-container>
              </li>
            </ol>
          </nav>

          <form [formGroup]="form" #f="ngForm" [ngClass]="{ 'is-submitted': nextIsClicked || f.submitted }" id="form">
            <table class="table table-hover text-center table-borderless">
              <thead>
                <tr class="border border-1 header bg-grey">
                  <th>Total</th>
                  <th>{{ totalUnits | number : "1.0-0" : "en-GB" }} {{ unitStructure.label }}s</th>
                  <th>{{ totalAreaSize | number : "1.2-2" : "en-GB" }}</th>
                  <th *ngIf="unitStructure.hasBeds()">{{ totalBeds | number : "1.0-0" : "en-GB" }}</th>
                  <th class="text-invisible" style="width: 20px">&times;></th>
                </tr>
                <tr class="border-bottom border-2 header">
                  <th>{{ unitStructure.label | titlecase }}</th>
                  <th>Description</th>
                  <th>
                    {{ unitStructure.areaType }}
                    <small>({{ unitStructure.areaSystem }})</small>
                  </th>
                  <th *ngIf="unitStructure.hasBeds()">Beds</th>
                  <th class="text-invisible" style="width: 20px">&times;></th>
                </tr>
              </thead>
              <tbody formArrayName="unitsScheduleData">
                <tr *ngFor="let unitScheduleData of unitsScheduleFormArray.controls; let i = index" [formGroupName]="i">
                  <ng-container formGroupName="unit">
                    <td>
                      <input class="form-control text-center" formControlName="identifier" placeholder="identifier" />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="description" placeholder="description" />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="areaSize" placeholder="0.00" />
                    </td>
                    <td *ngIf="unitStructure.hasBeds()">
                      <input class="form-control text-center" formControlName="beds" placeholder="0" />
                    </td>
                  </ng-container>
                  <td
                    style="width: 20px"
                    class="delete-hover cursor-pointer text-red rounded align-middle"
                    (click)="onConfirmDelete(i)"
                  >
                    &times;
                  </td>
                </tr>
              </tbody>
            </table>

            <div class="mt-3">
              <button type="button" class="btn btn-primary" (click)="onAddUnitScheduleData()">Add Unit</button>

              <div *ngIf="nextIsClicked && f.invalid" class="mt-1 border border-danger rounded">
                <div class="d-flex justify-content-center">
                  <ul class="m-1">
                    <li
                      *ngFor="let errorMessage of getFormArrayErrorMessages(unitsScheduleFormArray, 'unit')"
                      class="text-danger"
                    >
                      {{ errorMessage }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary m-2" (click)="onCancel()">Cancel</button>
          <button form="form" type="button" class="btn btn-success m-2" (click)="onNext()">Next ></button>
        </div>
      </ng-container>

      <ng-container *ngIf="step === 2 && mode !== 'delete'">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center">{{ mode | titlecase }} Unit Schedule</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
            (click)="onCancel()"
          ></button>
        </div>

        <div class="modal-body">
          <nav
            style="
              --bs-breadcrumb-divider: url(
                &#34;data:image/svg + xml,
                %3Csvgxmlns='http://www.w3.org/2000/svg'width='8'height='8'%3E%3Cpathd='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z'fill='currentColor'/%3E%3C/svg%3E&#34;
              );
            "
            aria-label="breadcrumb"
          >
            <ol class="breadcrumb justify-content-center">
              <li class="breadcrumb-item d-flex align-items-center">
                <span
                  class="px-2 d-flex align-items-center justify-content-center"
                  appDot
                  [status]="unitsStatus"
                ></span>
                <span class="px-2">Units</span>
              </li>
              <img src="{{ chevronRight }}" alt="" />
              <li class="breadcrumb-item d-flex align-items-center">
                <ng-container *ngIf="assetClass.investmentStrategy === 'buildToSell'">
                  <span
                    class="px-2 d-flex align-items-center justify-content-center"
                    appDot
                    [status]="salesStatus"
                  ></span>
                  <span class="px-2" [ngClass]="{ 'text-active': step === 2 }">Sales</span>
                </ng-container>

                <ng-container *ngIf="assetClass.investmentStrategy === 'buildToRent'">
                  <span
                    class="px-2 d-flex align-items-center justify-content-center"
                    appDot
                    [status]="lettingsStatus"
                  ></span>
                  <span class="px-2" [ngClass]="{ 'text-active': step === 2 }">Lettings</span>
                </ng-container>
              </li>
            </ol>
          </nav>

          <form [formGroup]="form" #f="ngForm" [ngClass]="{ 'is-submitted': nextIsClicked || f.submitted }" id="form">
            <table
              class="table table-hover text-center table-borderless uniform-width"
              *ngIf="assetClass.investmentStrategy === 'buildToSell'"
            >
              <thead>
                <tr class="border border-1 header bg-grey">
                  <th>Total</th>
                  <th>{{ totalSalePriceTarget | number : "1.2-2" : "en-GB" }}</th>
                  <th>{{ totalSalePriceAchieved | number : "1.2-2" : "en-GB" }}</th>
                  <th></th>
                  <th></th>
                  <th></th>
                </tr>
                <tr class="border-bottom border-2 header">
                  <th>{{ unitStructure.label | titlecase }}</th>
                  <th>Target price</th>
                  <th>Price achieved</th>
                  <th>Sale status</th>
                  <th>Status update</th>
                  <th>Buyer</th>
                </tr>
              </thead>
              <tbody formArrayName="unitsScheduleData">
                <tr *ngFor="let unitScheduleData of unitsScheduleFormArray.controls; let i = index" [formGroupName]="i">
                  <ng-container formGroupName="sale">
                    <td>
                      <input class="form-control text-center" value="{{ getUnitIdentifier(i) }}" disabled />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="priceTarget" placeholder="0" />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="priceAchieved" placeholder="0" />
                    </td>
                    <td>
                      <select class="form-select" id="status" formControlName="status" [compareWith]="compareFn">
                        <option *ngFor="let status of saleStatusChoices" [ngValue]="status.value">
                          {{ status.label }}
                        </option>
                      </select>
                    </td>
                    <td>
                      <ng-container *ngIf="unitScheduleData.get('sale.status')?.value !== 'available'; else noSale">
                        <input
                          class="form-control text-center cursor-pointer"
                          formControlName="statusDate"
                          placeholder="DD-MMM-YY"
                          bsDatepicker
                          [bsConfig]="{ dateInputFormat: 'DD MMM YY' }"
                        />
                      </ng-container>
                      <ng-template #noSale>
                        <input
                          class="form-control text-center"
                          formControlName="statusDate"
                          placeholder="-"
                          [attr.disabled]="true"
                          [value]="null"
                        />
                      </ng-template>
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="buyer" placeholder="-" />
                    </td>
                  </ng-container>
                </tr>
              </tbody>
            </table>

            <!-- <div class="container">
              <div class="row header bg-grey">
                <div class="col-2">Total</div>
                <div class="col-2">{{totalSalePriceTarget | number: '1.2-2' : 'en-GB'}}</div>
                <div class="col-2">{{totalSalePriceAchieved | number: '1.2-2' : 'en-GB'}}</div>
                <div class="col-2"></div>
                <div class="col-2"></div>
                <div class="col-2"></div>
              </div>

              <div class="row">
                <div class="col-2">{{unitStructure.label | titlecase}}</div>
                <div class="col-2">Target price</div>
                <div class="col-2">Price achieved</div>
                <div class="col-2">Sale status</div>
                <div class="col-2">Status update</div>
                <div class="col-2">Buyer</div>
              </div>

              <ng-container formArrayName="unitsScheduleData">
                 <div class="row" *ngFor='let unitScheduleData of unitsScheduleFormArray.controls; let i = index' [formGroupName]="i">
                  <ng-container formGroupName="sale">
                    <div class="col-2">
                      <input class="form-control text-center" value="{{getUnitIdentifier(i)}}" disabled>
                    </div>
                    <div class="col-2">
                      <input class="form-control text-center" formControlName="priceTarget" placeholder="0">
                    </div>
                    <div class="col-2">
                      <input class="form-control text-center" formControlName="priceAchieved" placeholder="0">
                    </div>
                    <div class="col-2">
                      <select class="form-select" id="status" formControlName="status" [compareWith]="compareFn">
                        <option *ngFor='let status of saleStatusChoices' [ngValue]="status.value">{{status.label}}
                        </option>
                      </select>
                    </div>
                    <div class="col-2">
                      <ng-container *ngIf="unitScheduleData.get('sale.status')?.value !== 'available' ; else noSale">
                        <input class="form-control text-center cursor-pointer" formControlName="statusDate" placeholder="DD-MMM-YY"
                        bsDatepicker [bsConfig]="{ dateInputFormat: 'DD MMM YY'}">
                      </ng-container>
                      <ng-template #noSale>
                        <input class="form-control text-center" formControlName="statusDate" placeholder="-"  [attr.disabled]="true" [value]="null">
                      </ng-template>
                    </div>
                    <div class="col-2">
                      <input class="form-control text-center" formControlName="buyer" placeholder="-">
                    </div>
                  </ng-container>
                 </div>
              </ng-container>
             
            </div> -->

            <table
              class="table table-hover text-center table-borderless"
              *ngIf="assetClass.investmentStrategy === 'buildToRent'"
            >
              <thead>
                <tr class="border border-1 header bg-grey">
                  <th>Total</th>
                  <th>{{ averageLeaseRentTarget | number : "1.2-2" : "en-GB" }}</th>
                  <th>{{ averageLeaseRentAchieved | number : "1.2-2" : "en-GB" }}</th>
                  <th></th>
                  <th></th>
                  <th></th>
                </tr>
                <tr class="border-bottom border-2 header">
                  <th>{{ unitStructure.label | titlecase }}</th>
                  <th>
                    Rent target
                    <small>({{ rentFrequencyLabel }})</small>
                  </th>
                  <th>
                    Rent achieved
                    <small>({{ rentFrequencyLabel }})</small>
                  </th>
                  <th>Start date</th>
                  <th>
                    Term
                    <small>({{ leaseFrequencyLabel }})</small>
                  </th>
                  <th>Tenant</th>
                </tr>
              </thead>
              <tbody formArrayName="unitsScheduleData">
                <tr *ngFor="let unitScheduleData of unitsScheduleFormArray.controls; let i = index" [formGroupName]="i">
                  <ng-container formGroupName="lease">
                    <td>
                      <input class="form-control text-center" value="{{ getUnitIdentifier(i) }}" disabled />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="rentTarget" placeholder="0" />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="rentAchieved" placeholder="0" />
                    </td>
                    <td>
                      <input
                        class="form-control text-center"
                        formControlName="startDate"
                        placeholder="DD-MMM-YY"
                        bsDatepicker
                        [bsConfig]="{ dateInputFormat: 'DD MMM YYYY' }"
                      />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="term" placeholder="1" />
                    </td>
                    <td>
                      <input class="form-control text-center" formControlName="tenant" placeholder="available" />
                    </td>
                  </ng-container>
                </tr>
              </tbody>
            </table>

            <div class="mt-3">
              <div *ngIf="nextIsClicked && f.invalid" class="mt-1 border border-danger rounded">
                <div class="d-flex justify-content-center">
                  <ul class="m-1" *ngIf="assetClass.investmentStrategy === 'buildToRent'">
                    <li
                      *ngFor="let errorMessage of getFormArrayErrorMessages(unitsScheduleFormArray, 'lease')"
                      class="text-danger"
                    >
                      {{ errorMessage }}
                    </li>
                  </ul>
                  <ul class="m-1" *ngIf="assetClass.investmentStrategy === 'buildToSell'">
                    <li
                      *ngFor="let errorMessage of getFormArrayErrorMessages(unitsScheduleFormArray, 'sale')"
                      class="text-danger"
                    >
                      {{ errorMessage }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-primary me-auto" (click)="onPrevious()">< Previous</button>
          <button type="button" class="btn btn-secondary m-2" (click)="onCancel()">Cancel</button>
          <button form="form" type="submit" class="btn btn-success m-2" (click)="onSave()">Save</button>
        </div>
      </ng-container>

      <ng-container *ngIf="mode === 'delete'">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center">{{ mode | titlecase }} Unit</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
            (click)="onCancel()"
          ></button>
        </div>

        <div class="modal-body">
          <p class="text-center my-auto">Are you sure you want to delete this unit?</p>

          <table class="table table-hover text-center table-borderless">
            <thead>
              <tr class="border-bottom border-2 header">
                <th>{{ unitStructure.label | titlecase }}</th>
                <th>Description</th>
                <th>{{ unitStructure.areaType }} ({{ unitStructure.areaSystem }})</th>
                <th *ngIf="unitStructure.hasBeds()">Beds</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  {{ getFormValue(unitsScheduleFormArray, index, "unit", "identifier") }}
                </td>
                <td>
                  {{ getFormValue(unitsScheduleFormArray, index, "unit", "description") }}
                </td>
                <td>
                  {{ getFormValue(unitsScheduleFormArray, index, "unit", "areaSize") }}
                </td>
                <td *ngIf="unitStructure.hasBeds()">
                  {{ getFormValue(unitsScheduleFormArray, index, "unit", "beds") }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary m-2" (click)="onCancelDelete()">Cancel</button>
          <button type="submit" class="btn btn-danger m-2" (click)="onRemoveUnitScheduleData()">Delete</button>
        </div>
      </ng-container>
    </div>
  </div>
</div>
